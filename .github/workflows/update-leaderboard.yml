name: ğŸ¤– Auto-update AI Leaderboard

on:
  schedule:
    # Run every 6 hours at 0, 6, 12, 18 UTC
    - cron: '0 0,6,12,18 * * *'
  
  # Also allow manual trigger
  workflow_dispatch:

jobs:
  scrape-leaderboard:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ğŸ” Scrape Artificial Analysis leaderboard
        run: |
          npx ts-node scripts/scrape-artificial-analysis.ts
      
      - name: ğŸ”¨ Build to verify changes
        run: npm run build --if-present
        continue-on-error: true
      
      - name: ğŸ“ Commit and push if changed
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "AI Leaderboard Bot"
          
          if git diff --quiet lib/ai/fetch-real-leaderboard.ts; then
            echo "âœ… No changes detected in leaderboard"
          else
            echo "ğŸ“Š Leaderboard updated! Committing changes..."
            git add lib/ai/fetch-real-leaderboard.ts
            git commit -m "ğŸ¤– Auto-update AI leaderboard from Artificial Analysis

Updated rankings from https://artificialanalysis.ai/leaderboards/models
Timestamp: $(date -u +'%Y-%m-%d %H:%M:%S UTC')
Triggered by: GitHub Actions"
            git push
            echo "âœ… Changes pushed!"
          fi
      
      - name: ğŸ“§ Notify if scraping failed
        if: failure()
        run: |
          echo "âš ï¸ Leaderboard scraping failed"
          echo "This is a non-critical task. Manual update may be needed."
